---
title: OpenClaw Integration
description: "Hook-based automatic memory for OpenClaw SIs"
---

# OpenClaw Integration

Kernle integrates with OpenClaw via **lifecycle hooks** — memory loads automatically at session start and saves automatically before compaction. No manual commands or native flat files required.

## How It Works

```
SESSION START (or post-compaction)
       ↓
1. OpenClaw fires `agent:bootstrap` event
2. Kernle hook executes: `kernle -s {stackId} load`
3. Output injected as virtual KERNLE.md in context
4. SI has full memory: values, beliefs, goals, checkpoint, episodes
       ↓
   SI WORKS (captures memories as they happen)
       ↓
CONTEXT PRESSURE RISES
       ↓
5. OpenClaw fires `memoryFlush` before compaction
6. SI saves checkpoint: `kernle checkpoint "specific task"`
7. Compaction happens (context reset)
       ↓
   CYCLE REPEATS (bootstrap fires again → KERNLE.md reloads)
```

<Note>
The SI never needs to run `kernle load` manually. The bootstrap hook handles it automatically at every session start and after every compaction.
</Note>

## What Replaces What

Kernle replaces OpenClaw's native static memory files:

| Native File | Kernle Replacement | Status |
|-------------|-------------------|--------|
| `SOUL.md` | Values, beliefs, self-narrative | **Replaced** — Kernle's dynamic identity evolves; SOUL.md is static |
| `USER.md` | Relationships layer | **Replaced** — Kernle tracks dynamic relationship state |
| `AGENTS.md` | Not replaced | **Kept** — boot sequence instructions (but no `kernle load` needed in it) |
| `TOOLS.md` | Boot config layer | **Replaced** — `kernle boot set key value` provides pre-load config |
| `MEMORY.md` | `KERNLE.md` (auto-injected) | **Replaced** — hook injects memory automatically |
| `HEARTBEAT.md` | Anxiety + periodic maintenance | **Optional** — heartbeats can still trigger Kernle maintenance |

<Warning>
`AGENTS.md` is the only native file that's still needed. It provides session-level instructions for the SI. But it no longer needs to contain `kernle load` instructions — the hook handles that.
</Warning>

## Installation

<Steps>
  <Step title="Install Kernle">
    ```bash
    pip install kernle
    # or
    pipx install kernle
    ```
  </Step>
  <Step title="Initialize a Stack">
    ```bash
    kernle -s my-project init
    ```
  </Step>
  <Step title="Run Setup">
    The setup command installs the bootstrap hook and configures pre-compaction memory flush in one step:
    ```bash
    kernle -s my-project setup clawdbot --enable
    ```
    This:
    1. Copies the `kernle-load` hook to `~/.config/moltbot/hooks/kernle-load/`
    2. Enables the hook in `~/.clawdbot/clawdbot.json`
    3. Configures `memoryFlush` for automatic pre-compaction checkpoint saving
  </Step>
  <Step title="Restart Gateway">
    ```bash
    clawdbot gateway restart
    ```
  </Step>
  <Step title="Verify">
    Start a new session and ask: *"Do you have memory context from Kernle?"*

    The SI should see `KERNLE.md` in its context files containing values, beliefs, goals, and checkpoint.
  </Step>
</Steps>

## Session Start: Automatic Loading

The `kernle-load` hook fires on every `agent:bootstrap` event — at session start and after every compaction.

### Stack ID Detection

The hook automatically detects which stack to load:

| Source | Example | Stack ID |
|--------|---------|----------|
| Session key | `agent:ash:main` | `ash` |
| Workspace directory | `/Users/ash/clawd` | `clawd` |
| Fallback | — | `main` |

### What Gets Injected

The hook runs `kernle -s {stackId} load` and injects the output as a virtual `KERNLE.md` file containing:

- **Checkpoint** — current task, context, next steps (resume point)
- **Values** — core principles
- **Beliefs** — held truths with confidence levels
- **Goals** — active goals with priority
- **Drives** — motivations with intensity
- **Lessons** — extracted from recent episodes
- **Relationships** — key entities with sentiment
- **Behavioral directives** — embedded instructions for seamless resumption

The SI sees this as a context file and resumes work naturally from the checkpoint.

### Budget-Aware Loading

Memory loading is budget-aware by default (8000 tokens). Items are loaded by priority: checkpoint > values > beliefs > goals > drives > episodes > notes > relationships. Lower-priority items are excluded if the budget is exhausted.

### Graceful Degradation

The hook fails silently if:
- Kernle is not installed
- No stack exists with the detected ID
- `kernle load` times out (>5 seconds)
- Any command error occurs

The session continues normally without Kernle memory.

## Pre-Compaction: Automatic Saving

OpenClaw's `memoryFlush` system prompts the SI to save state before compaction. The setup command configures this automatically.

When context pressure crosses the soft threshold:

1. OpenClaw sends a silent directive (NO_REPLY) to the SI
2. The directive prompts the SI to save a specific checkpoint
3. The SI runs `kernle checkpoint "<task>" --context "<progress>"`
4. Compaction proceeds
5. Bootstrap fires → KERNLE.md reloads with the fresh checkpoint

<Warning>
Checkpoint quality matters. The memoryFlush prompt guides the SI to be specific:
- **Bad**: `"Heartbeat complete"` or `"Saving state"`
- **Good**: `"Building auth API - finished /login endpoint, next: add JWT validation"`
</Warning>

## During Work

The SI captures memories as they happen. Each capture writes immediately to local storage — no checkpoint needed:

```bash
# Quick capture (raw layer)
kernle -s my-project raw "Noticed rate limits are per-user"

# Record a significant experience
kernle -s my-project episode "Debugged API timeout" "success" \
  --lesson "Check network latency before assuming code issues"

# Document a decision
kernle -s my-project note "Using Redis for session cache" \
  --type decision \
  --reason "Need sub-millisecond reads"
```

## Heartbeat Integration

Heartbeats are optional but useful for periodic memory maintenance during long sessions:

```markdown
## HEARTBEAT.md

During heartbeats, rotate through:
- Check memory anxiety: `kernle -s my-project anxiety`
- Review unprocessed raw captures
- Run promote if needed
- Save checkpoint if anxiety is elevated
```

## Configuration Reference

The setup command writes this to `~/.clawdbot/clawdbot.json`:

```json
{
  "hooks": {
    "internal": {
      "enabled": true,
      "entries": {
        "kernle-load": {
          "enabled": true
        }
      }
    }
  },
  "agents": {
    "defaults": {
      "compaction": {
        "memoryFlush": {
          "enabled": true,
          "prompt": "Before compaction, save your working state to Kernle..."
        }
      }
    }
  }
}
```

| Setting | Purpose |
|---------|---------|
| `hooks.internal.entries.kernle-load.enabled` | Enable/disable automatic memory loading |
| `agents.defaults.compaction.memoryFlush.enabled` | Enable/disable pre-compaction checkpoint saving |
| `agents.defaults.compaction.memoryFlush.prompt` | Prompt sent to SI before compaction |

## Expected Behavior

### After Compaction (Correct)

```
[Context compacted, bootstrap fires, KERNLE.md loads]

SI: "The /login endpoint is working. Moving on to /logout now —
     I'll need to invalidate the JWT token on the server side..."
```

The SI reads the checkpoint, resumes naturally, and does not announce recovery.

### After Compaction (Incorrect)

```
[Context compacted, bootstrap fires, KERNLE.md loads]

SI: "Waking up after compaction. Memory restored — working state
     shows I was on a 1pm heartbeat. Anxiety at 42..."
```

This indicates the checkpoint was generic or the SI's instructions override KERNLE.md guidance.

## Troubleshooting

### KERNLE.md not appearing in context

```bash
# Check hook is installed
ls ~/.config/moltbot/hooks/kernle-load/

# Check hook is enabled
cat ~/.clawdbot/clawdbot.json | grep -A 5 kernle-load

# Test manually
kernle -s my-project load
```

### SI asks what to work on after compaction

The checkpoint doesn't contain specific task information. Check that memoryFlush is configured and the prompt emphasizes specificity.

### Checkpoint is stale

```bash
# Check latest checkpoint
kernle -s my-project checkpoint load

# Verify memoryFlush is enabled
cat ~/.clawdbot/clawdbot.json | grep -A 10 memoryFlush
```

## Context Pressure Monitoring

| Context % | Action |
|-----------|--------|
| < 50% | Normal operation |
| 50-70% | Save checkpoint |
| 70-85% | Save checkpoint + record important episodes |
| 85%+ | Emergency save (memoryFlush handles this automatically) |

```bash
# Check memory health
kernle -s my-project anxiety

# Auto-fix memory issues
kernle -s my-project anxiety --auto

# Emergency save
kernle -s my-project anxiety --emergency --summary "Context near limit"
```

## Migrating from Native Files

If you're migrating an existing OpenClaw SI from static files to Kernle:

```bash
# Import existing SOUL.md identity into Kernle values/beliefs
kernle -s my-project import SOUL.md

# Import USER.md into relationships
kernle -s my-project import USER.md

# Import daily notes as episodes
kernle -s my-project import memory/

# Migrate TOOLS.md config to boot layer
kernle -s my-project boot set chat_id "2"
kernle -s my-project boot set gateway_ip "192.168.50.11"
```

After migration, remove the native files from the workspace (except `AGENTS.md`).

## Best Practices

<CardGroup cols={2}>
  <Card title="Capture Immediately" icon="bolt">
    Use `raw` for quick captures. Organize later during lulls.
  </Card>
  <Card title="No Mental Notes" icon="brain">
    If you want to remember something, capture it. "Mental notes" don't survive compaction.
  </Card>
  <Card title="Record Lessons" icon="graduation-cap">
    Episodes without lessons are incomplete. Always extract what you learned.
  </Card>
  <Card title="Specific Checkpoints" icon="floppy-disk">
    "Building auth API" not "Saving state". The checkpoint is how you resume.
  </Card>
</CardGroup>

## Logging

For debugging memory issues:

```bash
# Enable detailed logging
KERNLE_LOG_LEVEL=DEBUG kernle -s my-project load

# Log locations
~/.kernle/logs/local-*.log          # CLI operations
~/.kernle/logs/memory-events-*.log  # Memory events
```
