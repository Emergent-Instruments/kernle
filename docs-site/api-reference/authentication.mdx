---
title: Authentication
description: "API endpoints for authentication and key management"
---

# Authentication

Endpoints for user registration, login, and API key management.

## OAuth Token Exchange

Exchange a Supabase OAuth token for a Kernle session. Used by the web dashboard after Supabase authentication.

```http
POST /auth/oauth/token
```

### Request Body

```json
{
  "access_token": "supabase-jwt-access-token"
}
```

| Field | Type | Description |
|-------|------|-------------|
| `access_token` | string | JWT access token from Supabase OAuth flow |

### Response

```json
{
  "access_token": "string",
  "token_type": "bearer",
  "expires_in": 3600,
  "user_id": "string"
}
```

<Info>
This endpoint verifies Supabase JWTs using JWKS (JSON Web Key Set) public key verification.
</Info>

---

## Register Stack

Create a new stack and user record.

```http
POST /auth/register
```

### Request Body

```json
{
  "stack_id": "string (1-64 chars, lowercase alphanumeric, _, -)",
  "display_name": "string | null",
  "email": "string | null"
}
```

### Response

```json
{
  "access_token": "string",
  "token_type": "bearer",
  "expires_in": 3600,
  "user_id": "string",
  "secret": "string (SAVE THIS - shown only once)"
}
```

---

## Get Token (Stack Secret)

Get an access token for an existing stack using its secret.

```http
POST /auth/token
```

### Request Body

```json
{
  "stack_id": "string",
  "secret": "string"
}
```

### Response

```json
{
  "access_token": "string",
  "token_type": "bearer",
  "expires_in": 3600,
  "user_id": "string | null"
}
```

---

## Login (API Key â†’ JWT)

Validate an API key and return a fresh JWT. This endpoint expects the API key
in the `Authorization` header.

```http
POST /auth/login
Authorization: Bearer knl_sk_your-api-key
```

### Response

```json
{
  "user_id": "string",
  "stack_id": "string",
  "token": "string",
  "token_expires": "ISO timestamp"
}
```

---

## List API Keys

List all API keys for the authenticated user.

```http
GET /auth/keys
```

### Headers

```
Authorization: Bearer knl_sk_your-api-key
```

### Response

```json
{
  "keys": [
    {
      "id": "key_abc123",
      "name": "Development",
      "key_prefix": "knl_sk_abc12...",
      "created_at": "2024-01-01T00:00:00Z",
      "last_used_at": "2024-01-15T10:30:00Z",
      "is_active": true
    }
  ]
}
```

### CLI Equivalent

```bash
kernle auth keys list
```

---

## Create API Key

Create a new API key.

```http
POST /auth/keys
```

### Headers

```
Authorization: Bearer knl_sk_your-api-key
```

### Request Body

```json
{
  "name": "My New Key"
}
```

### Response

<Warning>
The full API key is only returned once at creation time. Store it securely.
</Warning>

```json
{
  "id": "key_xyz789",
  "name": "My New Key",
  "key": "knl_sk_full-api-key-only-shown-once",
  "key_prefix": "knl_sk_abc12",
  "created_at": "2024-01-15T10:30:00Z"
}
```

### CLI Equivalent

```bash
kernle auth keys create --name "My New Key"
```

---

## Revoke API Key

Revoke (deactivate) an API key.

```http
DELETE /auth/keys/{key_id}
```

### Headers

```
Authorization: Bearer knl_sk_your-api-key
```

### Response

204 No Content

### CLI Equivalent

```bash
kernle auth keys revoke key_abc123
```

---

## Cycle API Key

Generate a new key and deactivate the old one atomically.

```http
POST /auth/keys/{key_id}/cycle
```

### Headers

```
Authorization: Bearer knl_sk_your-api-key
```

### Response

```json
{
  "old_key_id": "key_abc123",
  "new_key": {
    "id": "key_xyz789",
    "name": "My New Key",
    "key": "knl_sk_new-api-key",
    "key_prefix": "knl_sk_abc12",
    "created_at": "2024-01-15T10:30:00Z"
  }
}
```

### CLI Equivalent

```bash
kernle auth keys cycle key_abc123
```

---

## Logout

Clear local credentials (client-side operation).

<Note>
This is a local operation. API keys remain active until explicitly revoked.
</Note>

### CLI Equivalent

```bash
kernle auth logout
```
